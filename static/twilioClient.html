<!DOCTYPE html>
<html>
<head>
    <title>Hello Client Monkey 1</title>
    <script type="text/javascript"
            src="//static.twilio.com/libs/twiliojs/1.2/twilio.min.js"></script>
    <script type="text/javascript"
            src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">
    </script>
    <link href="//static0.twilio.com/packages/quickstart/client.css"
          type="text/css" rel="stylesheet" />
    <script type="text/javascript">

        window.onload = function() {
            $.ajax("/twilioClient")
                    .done(function(msg){

                        /* Create the Client with a Capability Token */
                        Twilio.Device.setup(msg.token, {debug: true});

                        /* Let us know when the client is ready. */
                        Twilio.Device.ready(function (device) {
                            $("#log").text("Ready");
                        });

                        /* Report any errors on the screen */
                        Twilio.Device.error(function (error) {
                            $("#log").text("Error: " + error.message);
                        });

                        Twilio.Device.connect(function (conn) {
                            $("#log").text("Successfully established call");
                            conn.sendDigits("0000");
                        });

                        /* Connect to Twilio when we call this function. */

                    });


        };

        function call() {
            Twilio.Device.connect();
        }

    </script>
</head>
<body>

<button class="call" onclick="call();">
    Call
</button>

<div id="log">Loading pigeons...</div>
</body>
</html>